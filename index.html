<!DOCTYPE html>
<html>

<head>
  <title>Multiple Visualisations | An Example</title>
  <!-- Import Vega & Vega-Lite (does not have to be from CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/vega@5.20.2"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5.1.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6.17.0"></script>

  <!-- Import pure.css -->
  <link rel="stylesheet" href="https://unpkg.com/purecss@2.0.3/build/pure-min.css"
    integrity="sha384-cg6SkqEOCV1NbJoCu11+bm0NvBRc8IYLRGXkmNrqUBfTjmMYwNKPWBTIKyw9mHNJ" crossorigin="anonymous">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Google font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" rel="stylesheet">

  <!-- CSS file -->
  <link rel="stylesheet" type="text/css" href="css/styles.css" media="all">


</head>

<body>

  <style>
    .page p {
      max-width: 60em; /* Adjust as needed based on your font size and design */
    }
  </style>

  <div class="page">
    <!-- pure grid group -->
    <div class="pure-g">
      <div class="pure-u-1-1">
        <h1>Quality of life globally</h1>
        <p>This visualization delves into quality of life globally by unravelling the elements that affect countries' overall standard of living. By creating visualizations that uses a diverse group of datasets,  this will allow readers to analyze and explore the healthcare, happiness, economic well-being, environmental situation, and education levels of countries.</p>
      </div>
    </div>
    <!-- end pure grid group -->

    <!-- pure grid group -->
    <div class="pure-g">
        <div class="pure-u-1-1">
          <h2>Healthcare</h2>
          <h3>Mortality rates (Infant deaths, Under five deaths, Adult mortality)</h3>
          <ul>
            <li>Africa has the highest mortality rates overall out of all regions</li>
            <li>Oceania has the lowest morality rates overall out of all regions</li>
            <li>Democratic Republic of the Congo has the highest infant death rate</li>
            <li>Niger has the highest under five death rate</li>
            <li>Botswana has the highest Adult mortality rate</li>
          </ul>
          <p>More healthcare resources should be allocated to Africa in order to reduce its mortality rates</p>
          <div>
            <label for="data-dropdown">Select Data:</label>
            <select id="data-dropdown" onchange="updateMap(this.value)">
              <option value="Infant_deaths">Infant death rate</option>
              <option value="Under_five_deaths">Under five deaths rate</option>
              <option value="Adult_mortality">Adult mortality rate</option>
            </select>
          </div>
          <div>
            <div id="vis" class="vis-container"></div>
          </div>
        </div>
        <div class="pure-u-2-3">
          <div id="vis3" class="vis-container"></div>
        </div>
        <div class="pure-u-1-3">
          <div class="description description-right">
            <h3>Life expectancy (2000-2015)</h3>
            <p>Life expectancy of the top 5 highest populated countries between the year 2000 and 2015.</p>
            <ul>
              <li>All countries has improved their life expectancy from 2000 to 2015</li>
              <li>United States of America has the highest life expectancy overall</li>
              <li>India has the lowest life expectancy overall</li>
              <li>India has the largest life expectancy improvement overall</li>
            </ul>
          </div>
        </div>
      </div>
      <!-- end pure grid group -->

      <!-- pure grid group -->
      <div class="pure-g">
        <div class="pure-u-1-1">
            <h1>Happiness</h1>
            <h2>Social well-being and human rights</h2>
            <h3>Confidence In National Government & Freedom To Make Life Choices</h3>
            <p>Data info: Freedom to make life choices & Confidence in National Government (0=no, 1=yes) is the national average of binary responses</p>
            <p> </p>
            <ul>
              <li>As freedom to make life choices increases, Confidence in national government increases also (Strong corellation)</li>
              <li>There is no one region that always has the best or worst overall result over the years</li>
              <li>Latin America and Caribbean has more countries with higher freedom to make life choices compared to confidence in national government </li>
              <li> Singapore is the most consistent in having the highest confidence in national government and freedom to make life choices</li>
            </ul>
            <p>United States has shown a drop in the confidence in their national government, this indicates that the government should make more effort in satisfying people's demands</p>
        </div>
        <div class="pure-u-1-1"><div id="vis4" class="vis-container"></div></div>
        <div class="pure-u-1-3">
          <h2>Social support</h2>
          <h3>Top 8 countries with lowest social support</h3>
          <p>Data info: Social support (0-1) is the national average of the binary responses (0=no, 1=yes)</p>
          <ul> 
            <li>Afghanistan and Benin are the top 2 countries with the lowest social support</li>
            <li>Ivory Coast, Lebanon, Malawi, and Sierra Leone has a decent amount of social support</li>
            <li>Large social support difference between Afghanistan and other countries</li>
          </ul>
          <p>Afghanistan and Benin may require more social support resources</p>
      </div>
      <div class="pure-u-2-3"><div id="vis2" class="vis-container"></div></div>
      </div>
      <!-- end pure grid group -->

      <!-- pure grid group -->
      <div class="pure-g">
        <div class="pure-u-1-1">
            <h2>Economic well-being</h2>
            <h3>GDP per capita vs BMI</h3>
            <p>Lets take a look at the relationship between countries' economic development and its population's health and nutritional status.</p>
            <ul> 
              <li>United States has the best overall GDP per capita and BMI</li>
              <li>Ethiopia has the worst overall GDP per capita and BMI</li>
              <li>Africa has the most countries with the worst overall GDP per capita and BMI</li>
              <li>European Union has the most countries with the best overall GDP per capita and BMI</li>
            </ul>
            <p>Africa shows poor economic development and access to nutrition. More resources should be allocated to improve these areas.</p>
        </div>
        <div class="pure-u-1-1"><div id="vis1" class="vis-container"></div></div>
      </div>
      <!-- end pure grid group -->

      <!-- pure grid group -->
      <div class="pure-g">
        <div class="pure-u-1-3" >
          <div class="description description-left">
            <h2>Environmental factors</h2>
            <h3>CO2 emission (million tons per capita)</h3>
            <p>Here we take a look at the top 8 countries with the highest C02 emission (million tons per capita).</p>
              <ul>
              <li>China has the highest C02 emission</li>
              <li>United States of America has the second highest C02 emission</li>
              <li>Russia has the third highest C02 emission</li>
              <li>Australia has the lowest C02 emission</li>
            </ul>
            <p>China, United States of America, and Russia shows very high levels of CO2 emission, this indicates that this should be reduced</p>
          </div>
        </div>
        <div class="pure-u-2-3">
          <div id="vis6" class="spec-container"></div>
        </div>
    </div>
      <!-- end pure grid group -->

    <!-- pure grid group -->
    <div class="pure-g">
        <div class="pure-u-2-3">
          <div id="vis5" class="vis-container"></div>
        </div>
        <div class="pure-u-1-3">
          <div class="description description-right">
            <h2>Education</h2>
            <h3>Average school years (Regional)</h3>
            <ul>
              <li>Europe and North America are the top regions with highest average school years</li>
              <li>Asia, South America and Oceania are the second top regions with the highest average school years</li>
              <li>Africa has the lowest average school years</li>
            </ul>
            <p>Africa shows the lowest average school years, which indicates higher education expenditure should be allocated for this region.</p>
          </div>
        </div>
  
    </div>
      <!-- end pure grid group -->

      <!-- pure grid group -->
    <div class="pure-g">
      <div class="pure-u-1-1">
        <h1>Conclusion</h1>
        <p>After obeserving the visualizations and analyzing the results of countries' healthcare, happiness, education, economic, and environmental situation, there is a positive outlook globally in some areas such as life expectancy. However, it is important to take note of specific areas that still requires intervention such as reducing the amount of Co2 emissions, increasing average school years, improving social support, and reducing mortality rates for certain countries, as it's important that the quality of life of individuals, communities, and societies' should be protected which in turn benefits the nation as a whole.</p>
      </div>
    </div>
    <!-- end pure grid group -->

    <script type="text/javascript">
        var specVis1 = "./bubble_plot.json";
        var specVis2 = "./radial.json";
        var specVis3 = "./connected_dot_plot.json";
        var specVis4 = "./scatter.json";
        var specVis5 = "./line.json";
        var specVis6 = "./scatter&bar.json";

        vegaEmbed("#vis1", specVis1, {mode: "vega-lite"}).then(console.log).catch(console.warn);
        vegaEmbed("#vis2", specVis2, {mode: "vega-lite"}).then(console.log).catch(console.warn);
        vegaEmbed("#vis3", specVis3, {mode: "vega-lite"}).then(console.log).catch(console.warn);
        vegaEmbed("#vis4", specVis4, {mode: "vega-lite"}).then(console.log).catch(console.warn);
        vegaEmbed("#vis5", specVis5, {mode: "vega-lite"}).then(console.log).catch(console.warn);
        vegaEmbed("#vis6", specVis6, {mode: "vega-lite"}).then(console.log).catch(console.warn);

        let selectedData = 'Infant_deaths';  // Default selected data

        function updateMap(selectedValue) {
  // Default selected data to "Population"
  selectedData = selectedValue || 'Infant_deaths';

  let annotations = [];
  let tooltipFields = [{"field": "properties.NAME", "type": "nominal", "title": "Country"}];

    if (selectedData === 'Infant_deaths') {
    tooltipFields.push({"field": "absData", "type": "quantitative", "title": "Infant death rate"});
    } else if (selectedData === 'Under_five_deaths') {
    tooltipFields.push({"field": "absData", "type": "quantitative", "title": "Under five deaths rate"});
    } else if (selectedData === 'Adult_mortality') {
    tooltipFields.push({"field": "absData", "type": "quantitative", "title": "Adult mortality rate"});
    }

  const updatedSpec = {
    ...spec,
    layer: [
      ...spec.layer.slice(0, 3),
      {
        ...spec.layer[3],
        transform: [
          {
            "lookup": "properties.NAME",
            "from": {
              "data": {
                "url": "map_data.csv"
              },
              "key": "Country",
              "fields": [selectedData]
            }
          },
          {
            "calculate": `datum.${selectedData}`,
            "as": "absData"
          }
        ],
        encoding: {
          ...spec.layer[3].encoding,
          color: {
            ...spec.layer[3].encoding.color,
            field: "absData",
            legend: { "title": check(selectedData) }
          },
          tooltip: [ 
            ...tooltipFields  
          ]
        }
      },
      {
        "data": {
          "values": annotations,
          "format": { "type": "json" }
        },
        "mark": { "type": "text", "fontSize": 14, "fontWeight": "bold", "dy": -10 },
        "encoding": {
          "latitude": { "field": "latitude", "type": "quantitative" },
          "longitude": { "field": "longitude", "type": "quantitative" },
          "text": { "field": "name", "type": "nominal" }
        }
      }
    ]
  };

  vegaEmbed("#vis", updatedSpec, {mode: "vega-lite"}).then(console.log).catch(console.warn);
}

    function check(selectedData) {
    if (selectedData === "Infant_deaths") {
        return "Infant death rate";
    } else if (selectedData === "Under_five_deaths") {
        return "Under five deaths";
    } else if (selectedData === "Adult_mortality_rate") {
        return "Adult mortality rate";
    } else {
        return "Infant death rate";
    }
    }

    const spec = {
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": "Mortality Rates (2023)",
  "background": "#f2ebe9",
  "width": "container",
  "height": 400,
    "autosize": "fit",
  "data": {
    "url": "https://raw.githubusercontent.com/FIT3179/Vega-Lite/main/3_choropleth_map/js/ne_110m_admin_0_countries.topojson",
    "format": {"type": "topojson", "feature": "ne_110m_admin_0_countries"}
  },
  "mark": {"type": "geoshape", "fill": "lightgray",
  "stroke": "white"},
  "projection": {"type": "equalEarth"},
  "layer": [
    {
      "transform": [
        {
          "calculate": "'Data is not available in ' + datum.properties.NAME",
          "as": "note"
        }
      ],
      "mark": {"type": "geoshape", "fill": "lightgray", "stroke": "white"},
      "encoding": {"tooltip": {"field": "note"}}
    },
    {
      "data": {
        "url": "https://raw.githubusercontent.com/FIT3179/Vega-Lite/main/7_others/oceans.topojson",
        "format": {"type": "topojson", "feature": "oceans"}
      },
      "mark": {"type": "geoshape", "fill": "skyblue"}
    },
    {
      "data": {
        "url": "https://raw.githubusercontent.com/FIT3179/Vega-Lite/main/2_symbol_map/js/WorldMapWithGraticules.topojson",
        "format": {"type": "topojson", "feature": "ne_110m_graticules_30"}
      },
      "mark": {"type": "geoshape", "fill": null, "stroke": "lightgray"}
    },
    {
      "transform": [
        {
          "lookup": "properties.NAME",
          "from": {
            "data": {
              "url": "map_data.csv"
            },
            "key": "Country",
            "fields": ["Infant_deaths", "Under_five_deaths", "Adult_mortality"]
          }
        },
        {"filter": {"field": "Year", "equal": {"param": "year"}}},
        {
          "calculate": "datum.Infant_deaths",
          "as": "absGDP"
        }
      ],
      "mark": {"type": "geoshape", "stroke": "white"},
      "encoding": {
        "color": {
          "field": "absGDP",
          "type": "quantitative"
        },
        "tooltip": [
          {"field": "properties.NAME", "type": "nominal", "title": "Country"},
          {"field": "Year", "type": "quantitative", "title": "Year"}
        ]
      }
    }
  ],
  "config": {}
};

    vegaEmbed("#vis", spec, {mode: "vega-lite"}).then(console.log).catch(console.warn);
    updateMap();
    </script>

</body>
